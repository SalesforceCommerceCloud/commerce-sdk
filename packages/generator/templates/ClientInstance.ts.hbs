import { StaticClient, BaseClient, ClientConfig, ResponseError, AuthSchemes } from "@commerce-sdk/core";

import {
{{#each model.declares}}
    {{#eq $classData.name "amf.client.model.domain.NodeShape"}}
        {{getValue name}}{{#unless @last}},{{/unless}}
    {{/eq}}
{{/each}}
} from "./{{apiSpec}}.types";


export class Client extends BaseClient {
  constructor(config: ClientConfig) {
    super(config);

    if (!!!config.baseUri) {
      config.baseUri = "{{servers/0/url}}";
    }
    {{#each model.declares}}
      {{#is ./$classData/name "amf.client.model.domain.SecurityScheme"}}
        this.authSchemes["{{./name}}"] = new AuthSchemes["{{./name}}"]();
      {{/is}}
    {{/each}}
  }

{{#each model.encodes.endPoints}}
  {{#each operations}}
    {{#or (is method "get") (is method "delete") (is method "post") (is method "put")}}
      /**
      * {{description}}
      */
      {{name}}(
        parameters = {}{{#or (is method "post") (is method "put")}}, body: {{request.payloads.[0].schema.inherits.[0].linkTarget.name}}{{/or}}
      ): Promise<{{#if (eq (isReturnPayloadDefined .) true)}}{{getReturnPayloadType .}}{{else}}object{{/if}}> {

        const pathParameters = {
    {{#each ../parameters}}      
      "{{name}}": parameters["{{name}}"]{{#unless @last}},{{/unless}}
    {{/each}}
        };

    {{#if ../parameters}}
        for (let param in pathParameters) {
          if (pathParameters[param] === undefined
              || pathParameters[param] === null) {
            throw new Error(`Parameter '${param}' is required when calling {{name}}`);
          }
        }
    {{/if}}

        const queryParameters = {
    {{#each request/queryParameters}}      
      "{{name}}": parameters["{{name}}"]{{#unless @last}},{{/unless}}
    {{/each}}
        }

        const requiredQueryParameters = [];
    {{#each request/queryParameters}}
      {{#is required "true"}} 
        requiredQueryParameters.push("{{name}}");
      {{/is}}
    {{/each}}

    {{#if request/queryParameters}}
        for (let param in requiredQueryParameters) {
          if (queryParameters[param] === undefined
              || queryParameters[param] === null) {
            throw new Error(`Parameter '${param}' is required when calling {{name}}`);
          }
        }
    {{/if}}

    // @ts-ignore
    return StaticClient.{{method}}({
          client: this, 
          path: "{{../path}}",
          pathParameters: pathParameters, 
          queryParameters: queryParameters{{#or (is method "post") (is method "put")}}, body: body{{/or}}{{getSecurityScheme ", authScheme: " security}}
      });
    }

    {{/or}}
  {{/each}}
{{/each}}
}

export default Client;